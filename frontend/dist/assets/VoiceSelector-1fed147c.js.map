{"version":3,"file":"VoiceSelector-1fed147c.js","sources":["../../src/components/VoiceSelector.vue"],"sourcesContent":["<template>\r\n  <div class=\"voice-selector\">\r\n    <el-popover\r\n      v-model:visible=\"popoverVisible\"\r\n      placement=\"bottom-start\"\r\n      :width=\"520\"\r\n      trigger=\"click\"\r\n      popper-class=\"voice-popover\"\r\n    >\r\n      <template #reference>\r\n        <el-button class=\"voice-select-button\" size=\"small\">\r\n          {{ selectedVoiceLabel || '请选择语音' }}\r\n          <el-icon class=\"el-icon--right\"><arrow-down /></el-icon>\r\n        </el-button>\r\n      </template>\r\n      \r\n      <div class=\"voice-selection\">\r\n        <!-- 平铺布局 -->\r\n        <div class=\"voice-categories\">\r\n          <!-- 女声区域 -->\r\n          <div class=\"voice-category\">\r\n            <h4 class=\"category-title\">女声</h4>\r\n            <div class=\"voice-grid\">\r\n              <div\r\n                v-for=\"voice in femaleVoices\"\r\n                :key=\"voice.value\"\r\n                class=\"voice-item\"\r\n                :class=\"{ active: modelValue === voice.value }\"\r\n                @click=\"selectVoice(voice)\"\r\n              >\r\n                <div class=\"voice-name\">{{ voice.label }}</div>\r\n                <div class=\"voice-actions\">\r\n                  <el-button \r\n                    type=\"danger\" \r\n                    size=\"small\" \r\n                    circle\r\n                    :loading=\"previewLoading && previewVoice === voice.value\"\r\n                    @click.stop=\"previewVoice === voice.value ? stopPreview() : playPreview(voice.value)\"\r\n                  >\r\n                    <el-icon>\r\n                      <component :is=\"previewVoice === voice.value && isPlaying ? 'VideoPause' : 'VideoPlay'\" />\r\n                    </el-icon>\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- 男声区域 -->\r\n          <div class=\"voice-category\">\r\n            <h4 class=\"category-title\">男声</h4>\r\n            <div class=\"voice-grid\">\r\n              <div\r\n                v-for=\"voice in maleVoices\"\r\n                :key=\"voice.value\"\r\n                class=\"voice-item\"\r\n                :class=\"{ active: modelValue === voice.value }\"\r\n                @click=\"selectVoice(voice)\"\r\n              >\r\n                <div class=\"voice-name\">{{ voice.label }}</div>\r\n                <div class=\"voice-actions\">\r\n                  <el-button \r\n                    type=\"danger\" \r\n                    size=\"small\" \r\n                    circle\r\n                    :loading=\"previewLoading && previewVoice === voice.value\"\r\n                    @click.stop=\"previewVoice === voice.value ? stopPreview() : playPreview(voice.value)\"\r\n                  >\r\n                    <el-icon>\r\n                      <component :is=\"previewVoice === voice.value && isPlaying ? 'VideoPause' : 'VideoPlay'\" />\r\n                    </el-icon>\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- 童声区域 -->\r\n          <div class=\"voice-category\">\r\n            <h4 class=\"category-title\">童声</h4>\r\n            <div class=\"voice-grid\">\r\n              <div\r\n                v-for=\"voice in childVoices\"\r\n                :key=\"voice.value\"\r\n                class=\"voice-item\"\r\n                :class=\"{ active: modelValue === voice.value }\"\r\n                @click=\"selectVoice(voice)\"\r\n              >\r\n                <div class=\"voice-name\">{{ voice.label }}</div>\r\n                <div class=\"voice-actions\">\r\n                  <el-button \r\n                    type=\"danger\"\r\n                    size=\"small\" \r\n                    circle\r\n                    :loading=\"previewLoading && previewVoice === voice.value\"\r\n                    @click.stop=\"previewVoice === voice.value ? stopPreview() : playPreview(voice.value)\"\r\n                  >\r\n                    <el-icon>\r\n                      <component :is=\"previewVoice === voice.value && isPlaying ? 'VideoPause' : 'VideoPlay'\" />\r\n                    </el-icon>\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </el-popover>\r\n  </div>\r\n  \r\n  <!-- 隐藏的音频播放器 -->\r\n  <audio ref=\"audioPlayer\" @ended=\"handleAudioEnded\"></audio>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch, onUnmounted } from 'vue';\r\nimport { ArrowDown, VideoPlay, VideoPause } from '@element-plus/icons-vue';\r\nimport { ElMessage } from 'element-plus';\r\nimport axios from '@/utils/axios';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000';\r\n\r\nconst props = defineProps({\r\n  modelValue: {\r\n    type: String,\r\n    default: ''\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['update:modelValue']);\r\n\r\n// 状态变量\r\nconst popoverVisible = ref(false);\r\nconst previewLoading = ref(false);\r\nconst previewVoice = ref('');\r\nconst isPlaying = ref(false);\r\nconst audioPlayer = ref(null);\r\n\r\n// 定义语音列表\r\nconst voices = [\r\n  // 女声\r\n  { label: '小燕', value: 'zhiyan_emo', category: 'female' },\r\n  { label: '小美', value: 'zhimao', category: 'female' },\r\n \r\n  \r\n  // 男声\r\n  { label: '知哥', value: 'zhishuo', category: 'male' },\r\n  { label: '艾硕', value: 'aishuo', category: 'male' },  \r\n  \r\n  // 童声\r\n  { label: '知贝', value: 'zhibei_emo', category: 'child' },\r\n  { label: '杰力豆', value: 'jielidou', category: 'child' },\r\n  { label: '青青', value: 'qingqing', category: 'child' }\r\n];\r\n\r\n// 按类别分组\r\nconst femaleVoices = computed(() => voices.filter(v => v.category === 'female'));\r\nconst maleVoices = computed(() => voices.filter(v => v.category === 'male'));\r\nconst childVoices = computed(() => voices.filter(v => v.category === 'child'));\r\n\r\n// 当前选中的语音标签\r\nconst selectedVoiceLabel = computed(() => {\r\n  const voice = voices.find(v => v.value === props.modelValue);\r\n  return voice ? voice.label : '';\r\n});\r\n\r\n// 选择语音\r\nfunction selectVoice(voice) {\r\n  emit('update:modelValue', voice.value);\r\n  popoverVisible.value = false;\r\n}\r\n\r\n// 播放语音试听\r\nasync function playPreview(voice) {\r\n  if (isPlaying.value && previewVoice.value === voice) {\r\n    // 如果是同一个语音，并且正在播放，则暂停\r\n    stopPreview();\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    // 设置加载状态\r\n    previewLoading.value = true;\r\n    previewVoice.value = voice;\r\n    \r\n    // 停止当前播放\r\n    stopAudio();\r\n\r\n    // 请求生成试听音频\r\n    const response = await axios.post(`${API_BASE_URL}/api/tts/preview`, {\r\n      text: \"同学们好，欢迎来到我的课堂\",\r\n      voice: voice\r\n    });\r\n    \r\n    if (response.data.status === 'success') {\r\n      // 播放音频\r\n      audioPlayer.value.src = `${API_BASE_URL}${response.data.audio_url}`;\r\n      audioPlayer.value.load();\r\n      await audioPlayer.value.play();\r\n      isPlaying.value = true;\r\n    } else {\r\n      ElMessage.error('生成试听失败');\r\n    }\r\n  } catch (error) {\r\n    console.error('语音试听失败:', error);\r\n    ElMessage.error('语音试听失败');\r\n  } finally {\r\n    previewLoading.value = false;\r\n  }\r\n}\r\n\r\n// 停止预览\r\nfunction stopPreview() {\r\n  stopAudio();\r\n  isPlaying.value = false;\r\n}\r\n\r\n// 停止音频播放\r\nfunction stopAudio() {\r\n  if (audioPlayer.value) {\r\n    audioPlayer.value.pause();\r\n    audioPlayer.value.currentTime = 0;\r\n  }\r\n  isPlaying.value = false;\r\n}\r\n\r\n// 处理音频播放结束事件\r\nfunction handleAudioEnded() {\r\n  isPlaying.value = false;\r\n  previewVoice.value = '';\r\n}\r\n\r\n// 监听组件销毁\r\nonUnmounted(() => {\r\n  stopAudio();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.voice-selector {\r\n  display: inline-block;\r\n}\r\n\r\n.voice-select-button {\r\n  width: 100%;\r\n  text-align: left;\r\n  padding-right: 30px;\r\n  position: relative;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.voice-selection {\r\n  padding: 10px;\r\n}\r\n\r\n/* 分类区域样式 */\r\n.voice-categories {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\r\n}\r\n\r\n.voice-category {\r\n  border-bottom: 1px solid var(--el-border-color-lighter);\r\n  padding-bottom: 12px;\r\n}\r\n\r\n.voice-category:last-child {\r\n  border-bottom: none;\r\n  padding-bottom: 0;\r\n}\r\n\r\n.category-title {\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  margin: 0 0 8px 0;\r\n  color: var(--el-text-color-primary);\r\n}\r\n\r\n/* 改为网格布局 */\r\n.voice-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr); /* 三列布局 */\r\n  gap: 8px;\r\n}\r\n\r\n.voice-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 6px 10px;\r\n  border-radius: 4px;\r\n  border: 1px solid var(--el-border-color-light);\r\n  cursor: pointer;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.voice-item:hover {\r\n  background-color: var(--el-fill-color-light);\r\n}\r\n\r\n.voice-item.active {\r\n  border-color: var(--el-color-primary);\r\n  background-color: var(--el-color-primary-light-9);\r\n}\r\n\r\n.voice-name {\r\n  font-size: 13px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n.voice-actions {\r\n  display: flex;\r\n  flex-shrink: 0;\r\n  margin-left: 5px;\r\n}\r\n\r\n:deep(.voice-popover) {\r\n  padding: 0;\r\n}\r\n</style>\r\n"],"names":["API_BASE_URL","props","__props","emit","__emit","popoverVisible","ref","previewLoading","previewVoice","isPlaying","audioPlayer","voices","femaleVoices","computed","v","maleVoices","childVoices","selectedVoiceLabel","voice","selectVoice","playPreview","stopPreview","stopAudio","response","axios","ElMessage","error","handleAudioEnded","onUnmounted","_createElementVNode","_hoisted_1","_createVNode","_component_el_popover","$event","_component_el_button","_createTextVNode","_toDisplayString","_component_el_icon","_unref","ArrowDown","_hoisted_2","_hoisted_3","_hoisted_4","_cache","_hoisted_5","_createElementBlock","_Fragment","_renderList","_hoisted_7","_hoisted_8","_withModifiers","_openBlock","_createBlock","_resolveDynamicComponent","_hoisted_9","_hoisted_10","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_17","_hoisted_18"],"mappings":"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"}