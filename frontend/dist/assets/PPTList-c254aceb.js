import{_ as q,r as v,u as U,o as A,a as H,b as p,c as J,d as c,e as u,f as o,g as n,w as l,h as O,i as I,F as K,j as Q,k as h,E as _,l as f,m as g,n as C,p as W,t as b,q as X,s as Y,v as Z,x as ee,y as te,z as ae,A as ne,B as se,C as le,D as oe}from"./index-3f8b9c66.js";const ie={class:"ppt-list"},re={class:"header"},ce={class:"ppt-content"},de={key:1,class:"ppt-cards-grid"},ue={class:"ppt-card-content"},_e={class:"ppt-thumbnail-container"},fe={key:0,class:"thumbnail-loading"},me=["src","onError"],ge={class:"ppt-status-overlay"},ve={class:"ppt-detail"},pe=["title"],he={class:"ppt-info"},ye={class:"info-item"},Pe={key:0,class:"info-item"},be={key:1,class:"info-item"},we={class:"ppt-actions"},ke={__name:"PPTList",setup(Te){const $=v("http://edu.xiaojuai.com:8100"),E=v(localStorage.getItem("roles")),x=U(),m=v([]),w=v(!1);let d=null,i=null;const k=v(Date.now());function B(){x.push("/aiedu/generate-ppt/create")}async function y(){w.value=!0;try{const e=await h.get("/api/ppt/list");m.value=e.data.items}catch{_.error("获取课件列表失败")}finally{w.value=!1}}function D(e){if(e.status!=="completed"){_.warning("课件还未生成完成");return}window.open(`${$.value}${e.download_url}`,"_blank")}async function L(e){try{await Y.confirm("确定要删除这个课件吗？此操作不可恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.delete(`/api/ppt/delete/${e.id}`),_.success("删除成功"),y()}catch(t){t!=="cancel"&&_.error("删除失败")}}async function N(e){if(!e.isChecking){e.isChecking=!0;try{const t=await h.get(`/api/ppt/status/${e.id}`);t.data.status==="completed"&&(e.status="completed",e.download_url=t.data.download_url,await y(),_.success("PPT生成完成"))}catch(t){console.error("检查状态失败:",t),_.error("检查状态失败")}finally{e.isChecking=!1}}}function S(){const e=localStorage.getItem("lastGeneratedPPT");if(e)try{const t=JSON.parse(e);t&&t.file_id&&(d=t.file_id,z(),localStorage.removeItem("lastGeneratedPPT"))}catch(t){console.error("解析新生成PPT信息失败:",t)}}function z(){if(!d)return;console.log("开始轮询新生成的PPT:",d),i&&clearInterval(i);let e=0;const t=20;i=setInterval(async()=>{e++,console.log(`轮询新PPT(${d}) 第${e}次...`);try{const s=await h.get(`/api/ppt/status/${d}`),r=m.value.findIndex(T=>T.id===d);if(r!==-1&&(m.value[r].status=s.data.status,s.data.status==="completed")){console.log("PPT生成完成，更新状态和信息"),m.value[r].download_url=s.data.download_url,s.data.thumbnail&&(m.value[r].thumbnail=s.data.thumbnail,k.value=Date.now()),clearInterval(i),i=null,d=null,_.success("PPT生成完成");return}}catch(s){console.error("轮询检查失败:",s)}e>=t&&(clearInterval(i),i=null,d=null,console.log("达到最大轮询次数，轮询结束"),y())},2e3)}function F(e){console.error(`缩略图加载失败: ${e.thumbnail}`),e.retried||(console.log("尝试重新加载缩略图"),e.retried=!0,setTimeout(async()=>{try{const t=await h.get(`/api/ppt/status/${e.id}`);t.data.thumbnail&&(e.thumbnail=t.data.thumbnail,k.value=Date.now())}catch(t){console.error("重新获取缩略图失败:",t)}},1e3))}function M(){const e=document.createElement("style");e.innerHTML=`
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .thumbnail-loading .el-icon {
      animation: rotate 1.5s linear infinite;
      font-size: 32px;
      color: #409EFF;
      margin-bottom: 8px;
    }
    
    .thumbnail-loading {
      z-index: 2;
      background-color: rgba(245, 247, 250, 0.8);
    }
  `,document.head.appendChild(e)}function V(e){if(e.status!=="completed"){_.warning("课件还未生成完成，无法合成视频");return}x.push({path:"/aiedu/ppt-to-video/create",query:{pptId:e.id}})}return A(()=>{y(),S(),M()}),H(()=>{i&&(clearInterval(i),i=null)}),(e,t)=>{const s=p("el-icon"),r=p("el-button"),T=p("el-empty"),G=p("el-tag"),R=p("el-card"),j=J("loading");return c(),u("div",ie,[o("div",re,[t[1]||(t[1]=o("h2",null,"我的课件",-1)),n(r,{type:"primary",onClick:B},{default:l(()=>[n(s,null,{default:l(()=>[n(f(Z))]),_:1}),t[0]||(t[0]=g(" 创建课件 ",-1))]),_:1})]),O((c(),u("div",ce,[m.value.length===0?(c(),I(T,{key:0,description:"暂无课件"})):(c(),u("div",de,[(c(!0),u(K,null,Q(m.value,a=>(c(),I(R,{key:a.id,class:"ppt-card",shadow:"hover"},{default:l(()=>[o("div",ue,[o("div",_e,[a.status==="pending"||!a.thumbnail?(c(),u("div",fe,[n(s,{class:"is-loading"},{default:l(()=>[n(f(ee))]),_:1}),t[2]||(t[2]=o("span",null,"加载中...",-1))])):C("",!0),(c(),u("img",{key:`${a.id}-${k.value}`,src:a.thumbnail?`${$.value}${a.thumbnail}?t=${Date.now()}`:"/images/default-ppt.png",alt:"PPT缩略图",class:W(["ppt-thumbnail",{invisible:a.status==="pending"||!a.thumbnail}]),onError:P=>F(a)},null,42,me)),o("div",ge,[n(G,{type:a.status==="completed"?"success":"warning",size:"large",effect:"dark"},{default:l(()=>[g(b(a.status==="completed"?"已完成":"生成中"),1)]),_:2},1032,["type"])])]),o("div",ve,[o("h3",{class:"ppt-title",title:a.title},b(a.title),9,pe),o("div",he,[o("div",ye,[n(s,null,{default:l(()=>[n(f(te))]),_:1}),o("span",null,b(a.createTime),1)]),E.value==="admin"?(c(),u("div",Pe,[n(s,null,{default:l(()=>[n(f(ae))]),_:1}),o("span",null,"创建者: "+b(a.creator),1)])):C("",!0),a.status==="pending"?(c(),u("div",be,[n(r,{link:"",type:"primary",onClick:X(P=>N(a),["stop"]),loading:a.isChecking,class:"refresh-btn"},{default:l(()=>[n(s,null,{default:l(()=>[n(f(ne))]),_:1}),t[3]||(t[3]=g(" 刷新状态 ",-1))]),_:1},8,["onClick","loading"])])):C("",!0)]),o("div",we,[n(r,{type:"primary",disabled:a.status!=="completed",onClick:P=>D(a)},{default:l(()=>[n(s,null,{default:l(()=>[n(f(se))]),_:1}),t[4]||(t[4]=g(" 下载 ",-1))]),_:1},8,["disabled","onClick"]),n(r,{type:"success",disabled:a.status!=="completed",onClick:P=>V(a)},{default:l(()=>[n(s,null,{default:l(()=>[n(f(le))]),_:1}),t[5]||(t[5]=g(" 生成视频 ",-1))]),_:1},8,["disabled","onClick"]),n(r,{type:"text",onClick:P=>L(a)},{default:l(()=>[n(s,null,{default:l(()=>[n(f(oe))]),_:1}),t[6]||(t[6]=g(" 删除 ",-1))]),_:1},8,["onClick"])])])])]),_:2},1024))),128))]))])),[[j,w.value]])])}}},$e=q(ke,[["__scopeId","data-v-9fca1b0c"]]);export{$e as default};
//# sourceMappingURL=PPTList-c254aceb.js.map
