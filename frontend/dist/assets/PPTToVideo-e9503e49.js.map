{"version":3,"file":"PPTToVideo-e9503e49.js","sources":["../../src/views/ppt2video/PPTToVideo.vue"],"sourcesContent":["<template>\r\n  <div class=\"ppt-video-list\">\r\n    <div class=\"header\">\r\n      <h2>我的视频</h2>\r\n      <el-button type=\"primary\" @click=\"handleCreate\">\r\n        <el-icon><Plus /></el-icon>\r\n        创作视频\r\n      </el-button>\r\n    </div>\r\n\r\n    <!-- 视频列表卡片布局 -->\r\n    <div v-if=\"!loading && videoList.length > 0\" class=\"video-grid\">\r\n      <el-row :gutter=\"20\">\r\n  <el-col :xs=\"24\" :sm=\"24\" :md=\"24\" :lg=\"6\" :xl=\"6\" v-for=\"video in videoList\" :key=\"video.id\" class=\"video-card-col\">\r\n          <el-card class=\"video-card\" shadow=\"hover\">\r\n            <div class=\"video-card-content\">\r\n            <!-- 视频封面 -->\r\n            <div class=\"video-thumbnail\" @click=\"handlePreview(video)\">\r\n              <img :src=\"video.thumbnailUrl || defaultThumbnail\" alt=\"视频封面\">\r\n              <div class=\"video-duration\">{{ formatDuration(video.duration) }}</div>\r\n              \r\n              <!-- 视频状态标签 -->\r\n              <div v-if=\"video.status !== 'completed'\" class=\"video-status-overlay\">\r\n                <div v-if=\"video.status === 'processing'\" class=\"status-progress\">\r\n                  <el-progress \r\n                    :percentage=\"video.progress || 0\" \r\n                    :format=\"percentageFormat\"\r\n                    status=\"primary\" \r\n                    :stroke-width=\"6\"\r\n                    :show-text=\"true\"\r\n                  />\r\n                  <span>处理中...</span>\r\n                </div>\r\n                <el-tag v-else :type=\"getStatusType(video.status)\">\r\n                  {{ getStatusText(video.status) }}\r\n                </el-tag>\r\n              </div>\r\n              \r\n              <!-- 播放按钮 -->\r\n              <div v-if=\"video.status === 'completed'\" class=\"play-button\">\r\n                <el-icon><VideoPlay /></el-icon>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- 视频信息 -->\r\n            <div class=\"video-info\">\r\n              <h3 class=\"video-title\" :title=\"video.filename\">{{ video.filename }}</h3>\r\n              <div class=\"video-meta\">\r\n                <span class=\"create-time\">{{ formatDate(video.createTime) }}</span>\r\n                <span class=\"file-size\">{{ video.fileSize || '-' }}</span>\r\n              </div>\r\n              <!-- 管理员可见的用户名信息 -->\r\n              <div v-if=\"isAdmin\" class=\"video-owner\">\r\n                <el-tag size=\"small\" type=\"info\">\r\n                  <el-icon><User /></el-icon>\r\n                  {{ video.username || '未知用户' }}\r\n                </el-tag>\r\n              </div>\r\n            </div>\r\n                      \r\n            <!-- 操作按钮 -->\r\n            <div class=\"video-actions\">\r\n              <div class=\"main-actions\">\r\n                <el-button \r\n                  size=\"small\"\r\n                  type=\"primary\"\r\n                  @click=\"handleEdit(video)\"\r\n                  :disabled=\"video.status !== 'completed' && video.status !== 'pending'\"\r\n                >\r\n                  编辑\r\n                </el-button>\r\n                <el-button \r\n                  size=\"small\" \r\n                  type=\"success\"\r\n                  @click=\"handleDownload(video)\"\r\n                  :disabled=\"video.status !== 'completed'\"\r\n                >\r\n                  下载\r\n                </el-button>\r\n              </div>\r\n              \r\n              <!-- 添加更多操作的下拉菜单 -->\r\n              <div class=\"more-actions\">\r\n                <el-dropdown trigger=\"click\" @command=\"handleCommand($event, video)\">\r\n                  <el-button size=\"small\" type=\"text\">\r\n                    <el-icon><MoreFilled /></el-icon>\r\n                  </el-button>\r\n                  <template #dropdown>\r\n                    <el-dropdown-menu>\r\n                      <el-dropdown-item \r\n                        command=\"preview\" \r\n                        :disabled=\"video.status !== 'completed'\"\r\n                      >\r\n                        预览\r\n                      </el-dropdown-item>\r\n                      <el-dropdown-item \r\n                        command=\"delete\" \r\n                        divided\r\n                        class=\"text-danger\"\r\n                      >\r\n                        删除\r\n                      </el-dropdown-item>\r\n                    </el-dropdown-menu>\r\n                  </template>\r\n                </el-dropdown>\r\n              </div>\r\n            </div>\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n\r\n    <!-- 视频预览对话框 -->\r\n    <el-dialog\r\n      v-model=\"previewDialogVisible\"\r\n      title=\"视频预览\"\r\n      width=\"70%\"\r\n      destroy-on-close\r\n      @closed=\"handleVideoDialogClose\"\r\n    >\r\n      <div class=\"video-container\" v-if=\"currentVideo\">\r\n        <video \r\n          controls \r\n          :src=\"`${API_BASE_URL}${currentVideo.videoUrl}`\" \r\n          style=\"width: 100%\"\r\n          ref=\"videoPlayer\"\r\n          key=\"video-player\"\r\n        ></video>\r\n      </div>\r\n    </el-dialog>\r\n    \r\n    <!-- 加载中状态 -->\r\n    <div v-if=\"loading\" class=\"loading-container\">\r\n      <el-skeleton :rows=\"5\" animated />\r\n    </div>\r\n    \r\n    <!-- 空状态 -->\r\n    <el-empty \r\n      v-if=\"!loading && (!videoList || videoList.length === 0)\"\r\n      description=\"暂无视频，点击上方按钮开始制作\"\r\n    ></el-empty>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed, onUnmounted } from 'vue'\r\nimport { Document, Plus, VideoPlay, User, MoreFilled } from '@element-plus/icons-vue' // 添加User图标\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport { useRouter } from 'vue-router'\r\nimport axios from '@/utils/axios'\r\nimport { useUserStore } from '@/stores/user'\r\n\r\nconst userStore = useUserStore()\r\nconst router = useRouter()\r\nconst API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000'\r\nconst loading = ref(false)\r\nconst videoList = ref([])\r\nconst previewDialogVisible = ref(false)\r\nconst currentVideo = ref(null)\r\nconst videoPlayer = ref(null)\r\n\r\n// 默认封面图\r\nconst defaultThumbnail = `${API_BASE_URL}/static/images/default-video-thumbnail.jpg`\r\n\r\n// 检查当前用户是否为管理员\r\nconst isAdmin = computed(() => {\r\n  return userStore.roles && userStore.roles.includes('admin')\r\n})\r\n\r\n// 自动刷新任务列表\r\nconst processingVideos = ref(new Map()); // 存储处理中的视频及其轮询计数器\r\n\r\nonMounted(async () => {\r\n  await loadVideoList();\r\n  // 不再使用定时器，而是针对性地为处理中的视频设置轮询\r\n  trackProcessingVideos();\r\n});\r\n\r\nonUnmounted(() => {\r\n  // 清除所有视频轮询定时器\r\n  processingVideos.value.forEach(timerId => clearTimeout(timerId));\r\n});\r\n\r\n// 跟踪处理中的视频\r\nfunction trackProcessingVideos() {\r\n  // 先清除所有现有的定时器\r\n  processingVideos.value.forEach(timerId => clearTimeout(timerId));\r\n  processingVideos.value.clear();\r\n  \r\n  // 找出所有处理中的视频\r\n  const processing = videoList.value.filter(video => video.status === 'processing');\r\n  \r\n  // 为每个处理中的视频设置轮询\r\n  processing.forEach(video => {\r\n    const timerId = setTimeout(() => {\r\n      checkVideoStatus(video.id);\r\n    }, 3000); // 每3秒检查一次\r\n    \r\n    processingVideos.value.set(video.id, timerId);\r\n  });\r\n  \r\n  console.log(`正在跟踪 ${processing.length} 个处理中的视频`);\r\n}\r\n\r\n// 检查单个视频的状态\r\nasync function checkVideoStatus(videoId) {\r\n  try {\r\n    const response = await axios.get(`${API_BASE_URL}/api/video/${videoId}`);\r\n    const updatedVideo = response.data;\r\n    \r\n    // 更新列表中的视频信息\r\n    const index = videoList.value.findIndex(v => v.id === videoId);\r\n    if (index !== -1) {\r\n      const oldStatus = videoList.value[index].status;\r\n      const newStatus = updatedVideo.status;\r\n      \r\n      // 更新视频信息\r\n      videoList.value[index] = {\r\n        ...videoList.value[index],\r\n        ...updatedVideo,\r\n        // 强制更新缩略图URL，添加时间戳来避免缓存\r\n        thumbnailUrl: newStatus === 'completed' \r\n          ? `${API_BASE_URL}${updatedVideo.thumbnailUrl || updatedVideo.videoUrl}#t=0.1&_=${new Date().getTime()}`\r\n          : (videoList.value[index].thumbnailUrl || defaultThumbnail)\r\n      };\r\n      \r\n      console.log(`视频 ${videoId} 状态: ${oldStatus} -> ${newStatus}`);\r\n      \r\n      // 如果视频从处理中变为完成状态，强制刷新缩略图\r\n      if (oldStatus === 'processing' && newStatus === 'completed') {\r\n        // 延迟100ms后再次更新缩略图，确保服务器有时间生成\r\n        setTimeout(async () => {\r\n          try {\r\n            const refreshResponse = await axios.get(`${API_BASE_URL}/api/video/${videoId}`);\r\n            if (refreshResponse.data.thumbnailUrl) {\r\n              videoList.value[index].thumbnailUrl = `${API_BASE_URL}${refreshResponse.data.thumbnailUrl}?_=${new Date().getTime()}`;\r\n            } else if (refreshResponse.data.videoUrl) {\r\n              videoList.value[index].thumbnailUrl = `${API_BASE_URL}${refreshResponse.data.videoUrl}#t=0.1&_=${new Date().getTime()}`;\r\n            }\r\n          } catch (err) {\r\n            console.error('刷新缩略图失败:', err);\r\n          }\r\n        }, 100);\r\n      }\r\n      \r\n      // 如果视频仍在处理中，继续轮询\r\n      if (newStatus === 'processing') {\r\n        const timerId = setTimeout(() => {\r\n          checkVideoStatus(videoId);\r\n        }, 3000);\r\n        \r\n        processingVideos.value.set(videoId, timerId);\r\n      } else {\r\n        // 如果视频处理完成或失败，停止轮询\r\n        processingVideos.value.delete(videoId);\r\n        \r\n        // 显示提示消息\r\n        if (newStatus === 'completed') {\r\n          ElMessage({\r\n            message: '视频已生成完成!',\r\n            type: 'success'\r\n          });\r\n        } else if (newStatus === 'failed') {\r\n          ElMessage({\r\n            message: '视频生成失败',\r\n            type: 'error'\r\n          });\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error(`检查视频 ${videoId} 状态失败:`, error);\r\n    \r\n    // 如果发生错误，继续尝试轮询几次\r\n    const attempts = processingVideos.value.get(videoId) || 0;\r\n    if (typeof attempts === 'number' && attempts < 5) {\r\n      const timerId = setTimeout(() => {\r\n        checkVideoStatus(videoId);\r\n      }, 5000); // 发生错误后，延长轮询间隔\r\n      \r\n      processingVideos.value.set(videoId, timerId);\r\n    } else {\r\n      processingVideos.value.delete(videoId);\r\n    }\r\n  }\r\n}\r\n\r\n// 修改原有的loadVideoList函数\r\nasync function loadVideoList() {\r\n  loading.value = true;\r\n  try {\r\n    const response = await axios.get(`${API_BASE_URL}/api/video/list`);\r\n    \r\n    videoList.value = response.data.map(video => {\r\n      return {\r\n        ...video,\r\n        // 添加时间戳防止缓存\r\n        thumbnailUrl: video.thumbnailUrl \r\n          ? `${API_BASE_URL}${video.thumbnailUrl}?_=${new Date().getTime()}` \r\n          : (video.videoUrl ? `${API_BASE_URL}${video.videoUrl}#t=0.1&_=${new Date().getTime()}` : null)\r\n      };\r\n    });\r\n    \r\n    // 加载完成后，开始跟踪处理中的视频\r\n    trackProcessingVideos();\r\n    \r\n  } catch (error) {\r\n    console.error('获取视频列表失败:', error);\r\n    ElMessage.error('获取视频列表失败');\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n}\r\n\r\n// 删除原有的checkProcessingVideos函数，不再需要定时刷新整个列表\r\n\r\nfunction handleCreate() {\r\n  router.push('/aiedu/ppt-to-video/create')\r\n}\r\n\r\n// 修改视频预览处理函数\r\nfunction handlePreview(row) {\r\n  currentVideo.value = row\r\n  // 在视频URL后添加时间戳，强制浏览器重新加载\r\n  if (row.videoUrl) {\r\n    currentVideo.value = {\r\n      ...row,\r\n      videoUrl: `${row.videoUrl}?t=${new Date().getTime()}`\r\n    }\r\n  }\r\n  previewDialogVisible.value = true\r\n}\r\n\r\nfunction handleVideoDialogClose() {\r\n  // 确保video元素存在且有效\r\n  if (videoPlayer.value) {\r\n    // 暂停视频播放\r\n    videoPlayer.value.pause();\r\n    // 重置视频到开头\r\n    videoPlayer.value.currentTime = 0;\r\n  }\r\n}\r\n\r\nfunction handleDownload(row) {\r\n  if (row && row.videoUrl) {\r\n    // 提取文件名和扩展名\r\n    const filename = `${row.filename || '视频'}.mp4`;\r\n    \r\n    // 创建一个XHR请求获取文件内容为Blob\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open('GET', `${API_BASE_URL}${row.videoUrl}`, true);\r\n    xhr.responseType = 'blob';\r\n    \r\n    xhr.onload = function() {\r\n      if (this.status === 200) {\r\n        // 创建Blob URL\r\n        const blob = new Blob([this.response], {type: 'video/mp4'});\r\n        const url = window.URL.createObjectURL(blob);\r\n        \r\n        // 创建下载链接并触发点击\r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.download = filename;\r\n        link.click();\r\n        \r\n        // 释放Blob URL\r\n        setTimeout(() => {\r\n          window.URL.revokeObjectURL(url);\r\n        }, 100);\r\n      }\r\n    };\r\n    \r\n    xhr.send();\r\n  } else {\r\n    ElMessage.error('视频链接无效');\r\n  }\r\n}\r\n\r\nasync function handleDelete(row) {\r\n  try {\r\n    await ElMessageBox.confirm(\r\n      '确定要删除这个视频及其所有相关资源吗？此操作不可恢复！', \r\n      '删除确认', \r\n      {\r\n        type: 'warning',\r\n        confirmButtonText: '确认删除',\r\n        cancelButtonText: '取消'\r\n      }\r\n    )\r\n    \r\n    const response = await axios.delete(`${API_BASE_URL}/api/video/${row.id}`);\r\n    \r\n    if (response.data && response.data.status === 'success') {\r\n      ElMessage({\r\n        type: 'success',\r\n        message: response.data.message || '视频已成功删除'\r\n      });\r\n      \r\n      // 立即从本地列表中移除该视频，无需重新加载整个列表\r\n      videoList.value = videoList.value.filter(item => item.id !== row.id);\r\n    } else {\r\n      throw new Error(response.data?.message || '删除失败');\r\n    }\r\n  } catch (error) {\r\n    if (error === 'cancel') return;\r\n    \r\n    console.error('删除视频失败:', error)\r\n    ElMessage.error(error.message || '删除失败');\r\n  }\r\n}\r\n\r\n// 添加编辑处理函数\r\nfunction handleEdit(row) {\r\n  router.push(`/aiedu/ppt-to-video/edit/${row.id}`);\r\n}\r\n\r\nfunction formatDate(date) {\r\n  if (!date) return '-'\r\n  return new Date(date).toLocaleString()\r\n}\r\n\r\nfunction formatDuration(duration) {\r\n  if (!duration) return '--:--'\r\n  \r\n  // 检查输入类型并处理\r\n  let seconds;\r\n  if (typeof duration === 'string') {\r\n    // 如果是 \"01:23\" 或 \"01:23:45\" 格式的字符串，直接返回\r\n    if (/^\\d{2}:\\d{2}(:\\d{2})?$/.test(duration)) {\r\n      return duration;\r\n    }\r\n    // 尝试将字符串转换为数字\r\n    seconds = parseFloat(duration);\r\n  } else {\r\n    seconds = duration;\r\n  }\r\n  \r\n  // 确保有效的数字\r\n  if (isNaN(seconds)) return '--:--';\r\n  \r\n  // 将秒数转换为分:秒格式\r\n  const minutes = Math.floor(seconds / 60);\r\n  const remainingSeconds = Math.floor(seconds % 60);\r\n  return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n}\r\n\r\nfunction getStatusType(status) {\r\n  const types = {\r\n    completed: 'success',\r\n    pending: 'warning',\r\n    processing: 'info',\r\n    failed: 'danger'\r\n  }\r\n  return types[status] || 'info'\r\n}\r\n\r\nfunction getStatusText(status) {\r\n  const texts = {\r\n    completed: '已完成',\r\n    pending: '待处理',\r\n    processing: '处理中',\r\n    failed: '失败'\r\n  }\r\n  return texts[status] || status\r\n}\r\n\r\n// 格式化百分比显示\r\nfunction percentageFormat(percentage) {\r\n  return percentage ? `${percentage.toFixed(0)}%` : '0%';\r\n}\r\n\r\n// 添加处理下拉命令的函数\r\nfunction handleCommand(command, video) {\r\n  switch (command) {\r\n    case 'preview':\r\n      handlePreview(video);\r\n      break;\r\n    case 'delete':\r\n      handleDelete(video);\r\n      break;\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.ppt-video-list {\r\n  padding: 20px;\r\n  background: #fff;\r\n  border-radius: 8px;\r\n  box-shadow: var(--el-box-shadow-light);\r\n  min-height: auto;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 28px;\r\n}\r\n\r\n/* 视频网格布局 */\r\n.video-grid {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.video-card-col {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.video-card {\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  transition: transform 0.2s;\r\n}\r\n\r\n.video-card:hover {\r\n  transform: translateY(-5px);\r\n}\r\n\r\n.video-card-content {\r\n  display: block;\r\n}\r\n\r\n/* 小于1200px时单列显示（保险：配合 el-col 响应式） */\r\n@media (max-width: 1199.98px) {\r\n  .video-grid .el-row {\r\n    margin-left: 0 !important;\r\n    margin-right: 0 !important;\r\n  }\r\n  .video-card-col {\r\n    padding-left: 0 !important;\r\n    padding-right: 0 !important;\r\n  }\r\n\r\n  /* 小屏横向布局应用到自定义容器，避免依赖 :deep */\r\n  .video-card-content {\r\n    display: grid;\r\n    grid-template-columns: calc(140px * 16 / 9) 1fr;\r\n    grid-template-rows: auto auto;\r\n    column-gap: 16px;\r\n    row-gap: 8px;\r\n    align-items: start;\r\n  }\r\n\r\n  /* 左侧缩略图固定比例和高度（与 PPT 列表一致 140px） */\r\n  .video-thumbnail {\r\n    /* 固定高度 140px，宽度为 16:9 */\r\n    grid-column: 1 / 2;\r\n    grid-row: 1 / 3;\r\n    width: calc(140px * 16 / 9);\r\n    padding-top: 0; /* 覆盖原有的 56.25% 比例占位 */\r\n    border-radius: 4px;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .video-thumbnail img {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: cover;\r\n    position: static;\r\n  }\r\n\r\n  /* 右侧信息区域占据剩余空间，纵向排布 */\r\n  .video-info {\r\n    grid-column: 2 / 3;\r\n    grid-row: 1 / 2;\r\n    padding: 0;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: flex-start;\r\n  }\r\n\r\n  /* 操作区域放在信息区下方，占满右侧宽度 */\r\n  .video-actions {\r\n    grid-column: 2 / 3;\r\n    grid-row: 2 / 3;\r\n    padding-left: 0;\r\n    margin-top: 8px;\r\n    border-top: none;\r\n  }\r\n}\r\n\r\n.video-thumbnail {\r\n  position: relative;\r\n  width: 100%;\r\n  padding-top: 56.25%; /* 16:9 比例 */\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n  background-color: #000;\r\n  cursor: pointer;\r\n}\r\n\r\n.video-thumbnail img {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n}\r\n\r\n.video-duration {\r\n  position: absolute;\r\n  bottom: 8px;\r\n  right: 8px;\r\n  background-color: rgba(0, 0, 0, 0.7);\r\n  color: white;\r\n  padding: 2px 6px;\r\n  border-radius: 4px;\r\n  font-size: 12px;\r\n}\r\n\r\n.video-status-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n}\r\n\r\n.status-progress {\r\n  width: 80%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n.status-progress span {\r\n  margin-top: 8px;\r\n  color: white;\r\n  font-size: 14px;\r\n}\r\n\r\n.play-button {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 50px;\r\n  height: 50px;\r\n  border-radius: 50%;\r\n  background-color: rgba(255, 255, 255, 0.8);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.play-button .el-icon {\r\n  font-size: 24px;\r\n  color: var(--el-color-primary);\r\n}\r\n\r\n.video-thumbnail:hover .play-button {\r\n  opacity: 1;\r\n}\r\n\r\n.video-info {\r\n  padding: 12px 0;\r\n  flex-grow: 1;\r\n}\r\n\r\n.video-title {\r\n  margin: 0 0 8px;\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.video-meta {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  color: var(--el-text-color-secondary);\r\n  font-size: 12px;\r\n  margin-bottom: 8px; /* 添加底部边距 */\r\n}\r\n\r\n/* 添加用户名标签样式 */\r\n.video-owner {\r\n  margin-top: 4px;\r\n}\r\n\r\n.video-owner .el-icon {\r\n  margin-right: 4px;\r\n}\r\n\r\n/* 视频操作区域样式调整 */\r\n.video-actions {\r\n  display: flex;\r\n  justify-content: space-between; /* 两端对齐而非flex-start */\r\n  padding-top: 12px;\r\n  border-top: 1px solid var(--el-border-color-lighter);\r\n}\r\n\r\n.main-actions {\r\n  display: flex;\r\n  gap: 8px;\r\n}\r\n\r\n.more-actions {\r\n  margin-left: auto; /* 确保靠右对齐 */\r\n}\r\n\r\n/* 让删除按钮文字变成红色 */\r\n:deep(.text-danger) {\r\n  color: var(--el-color-danger);\r\n}\r\n\r\n.video-container {\r\n  background-color: #000;\r\n  border-radius: 8px;\r\n  overflow: hidden;\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.loading-container {\r\n  padding: 20px 0;\r\n}\r\n\r\n/* 进度条样式 */\r\n.status-progress :deep(.el-progress-bar__inner) {\r\n  transition: width 0.6s ease;\r\n}\r\n\r\n.status-progress :deep(.el-progress__text) {\r\n  color: white;\r\n}\r\n</style>\r\n"],"names":["userStore","useUserStore","router","useRouter","API_BASE_URL","loading","ref","videoList","previewDialogVisible","currentVideo","videoPlayer","defaultThumbnail","isAdmin","computed","processingVideos","onMounted","loadVideoList","trackProcessingVideos","onUnmounted","timerId","processing","video","checkVideoStatus","videoId","updatedVideo","axios","index","v","oldStatus","newStatus","refreshResponse","err","ElMessage","error","attempts","response","handleCreate","handlePreview","row","handleVideoDialogClose","handleDownload","filename","xhr","blob","url","link","handleDelete","ElMessageBox","item","handleEdit","formatDate","date","formatDuration","duration","seconds","minutes","remainingSeconds","getStatusType","status","getStatusText","percentageFormat","percentage","handleCommand","command","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_createVNode","_component_el_button","_component_el_icon","_unref","Plus","_hoisted_3","_component_el_row","_Fragment","_renderList","_createBlock","_component_el_col","_component_el_card","_hoisted_4","$event","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","_component_el_progress","_component_el_tag","_hoisted_10","VideoPlay","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","User","_hoisted_17","_hoisted_18","_hoisted_19","_component_el_dropdown","_component_el_dropdown_menu","_component_el_dropdown_item","MoreFilled","_component_el_dialog","_hoisted_20","_hoisted_22","_component_el_skeleton","_component_el_empty"],"mappings":"+0BAyJA,MAAMA,EAAYC,GAAc,EAC1BC,EAASC,GAAW,EACpBC,EAAe,+BACfC,EAAUC,EAAI,EAAK,EACnBC,EAAYD,EAAI,EAAE,EAClBE,EAAuBF,EAAI,EAAK,EAChCG,EAAeH,EAAI,IAAI,EACvBI,EAAcJ,EAAI,IAAI,EAGtBK,EAAmB,GAAGP,CAAY,6CAGlCQ,EAAUC,GAAS,IAChBb,EAAU,OAASA,EAAU,MAAM,SAAS,OAAO,CAC3D,EAGKc,EAAmBR,EAAI,IAAI,GAAK,EAEtCS,GAAU,SAAY,CACpB,MAAMC,EAAa,EAEnBC,GACF,CAAC,EAEDC,GAAY,IAAM,CAEhBJ,EAAiB,MAAM,QAAQK,GAAW,aAAaA,CAAO,CAAC,CACjE,CAAC,EAGD,SAASF,GAAwB,CAE/BH,EAAiB,MAAM,QAAQK,GAAW,aAAaA,CAAO,CAAC,EAC/DL,EAAiB,MAAM,QAGvB,MAAMM,EAAab,EAAU,MAAM,OAAOc,GAASA,EAAM,SAAW,YAAY,EAGhFD,EAAW,QAAQC,GAAS,CAC1B,MAAMF,EAAU,WAAW,IAAM,CAC/BG,EAAiBD,EAAM,EAAE,CAC1B,EAAE,GAAI,EAEPP,EAAiB,MAAM,IAAIO,EAAM,GAAIF,CAAO,CAChD,CAAG,EAED,QAAQ,IAAI,QAAQC,EAAW,MAAM,UAAU,CACjD,CAGA,eAAeE,EAAiBC,EAAS,CACvC,GAAI,CAEF,MAAMC,GADW,MAAMC,EAAM,IAAI,GAAGrB,CAAY,cAAcmB,CAAO,EAAE,GACzC,KAGxBG,EAAQnB,EAAU,MAAM,UAAUoB,GAAKA,EAAE,KAAOJ,CAAO,EAC7D,GAAIG,IAAU,GAAI,CAChB,MAAME,EAAYrB,EAAU,MAAMmB,CAAK,EAAE,OACnCG,EAAYL,EAAa,OAgC/B,GA7BAjB,EAAU,MAAMmB,CAAK,EAAI,CACvB,GAAGnB,EAAU,MAAMmB,CAAK,EACxB,GAAGF,EAEH,aAAcK,IAAc,YACxB,GAAGzB,CAAY,GAAGoB,EAAa,cAAgBA,EAAa,QAAQ,YAAY,IAAI,OAAO,QAAS,CAAA,GACnGjB,EAAU,MAAMmB,CAAK,EAAE,cAAgBf,CACpD,EAEM,QAAQ,IAAI,MAAMY,CAAO,QAAQK,CAAS,OAAOC,CAAS,EAAE,EAGxDD,IAAc,cAAgBC,IAAc,aAE9C,WAAW,SAAY,CACrB,GAAI,CACF,MAAMC,EAAkB,MAAML,EAAM,IAAI,GAAGrB,CAAY,cAAcmB,CAAO,EAAE,EAC1EO,EAAgB,KAAK,aACvBvB,EAAU,MAAMmB,CAAK,EAAE,aAAe,GAAGtB,CAAY,GAAG0B,EAAgB,KAAK,YAAY,MAAM,IAAI,KAAI,EAAG,QAAS,CAAA,GAC1GA,EAAgB,KAAK,WAC9BvB,EAAU,MAAMmB,CAAK,EAAE,aAAe,GAAGtB,CAAY,GAAG0B,EAAgB,KAAK,QAAQ,YAAY,IAAI,KAAI,EAAG,QAAS,CAAA,GAExH,OAAQC,EAAK,CACZ,QAAQ,MAAM,WAAYA,CAAG,CAC9B,CACF,EAAE,GAAG,EAIJF,IAAc,aAAc,CAC9B,MAAMV,EAAU,WAAW,IAAM,CAC/BG,EAAiBC,CAAO,CACzB,EAAE,GAAI,EAEPT,EAAiB,MAAM,IAAIS,EAASJ,CAAO,CACnD,MAEQL,EAAiB,MAAM,OAAOS,CAAO,EAGjCM,IAAc,YAChBG,EAAU,CACR,QAAS,WACT,KAAM,SAClB,CAAW,EACQH,IAAc,UACvBG,EAAU,CACR,QAAS,SACT,KAAM,OAClB,CAAW,CAGN,CACF,OAAQC,EAAO,CACd,QAAQ,MAAM,QAAQV,CAAO,SAAUU,CAAK,EAG5C,MAAMC,EAAWpB,EAAiB,MAAM,IAAIS,CAAO,GAAK,EACxD,GAAI,OAAOW,GAAa,UAAYA,EAAW,EAAG,CAChD,MAAMf,EAAU,WAAW,IAAM,CAC/BG,EAAiBC,CAAO,CACzB,EAAE,GAAI,EAEPT,EAAiB,MAAM,IAAIS,EAASJ,CAAO,CACjD,MACML,EAAiB,MAAM,OAAOS,CAAO,CAExC,CACH,CAGA,eAAeP,GAAgB,CAC7BX,EAAQ,MAAQ,GAChB,GAAI,CACF,MAAM8B,EAAW,MAAMV,EAAM,IAAI,GAAGrB,CAAY,iBAAiB,EAEjEG,EAAU,MAAQ4B,EAAS,KAAK,IAAId,IAC3B,CACL,GAAGA,EAEH,aAAcA,EAAM,aAChB,GAAGjB,CAAY,GAAGiB,EAAM,YAAY,MAAM,IAAI,KAAI,EAAG,QAAO,CAAE,GAC7DA,EAAM,SAAW,GAAGjB,CAAY,GAAGiB,EAAM,QAAQ,YAAY,IAAI,KAAM,EAAC,QAAO,CAAE,GAAK,IACnG,EACK,EAGDJ,GAED,OAAQgB,EAAO,CACd,QAAQ,MAAM,YAAaA,CAAK,EAChCD,EAAU,MAAM,UAAU,CAC9B,QAAY,CACR3B,EAAQ,MAAQ,EACjB,CACH,CAIA,SAAS+B,GAAe,CACtBlC,EAAO,KAAK,4BAA4B,CAC1C,CAGA,SAASmC,EAAcC,EAAK,CAC1B7B,EAAa,MAAQ6B,EAEjBA,EAAI,WACN7B,EAAa,MAAQ,CACnB,GAAG6B,EACH,SAAU,GAAGA,EAAI,QAAQ,MAAM,IAAI,KAAI,EAAG,QAAO,CAAE,EACpD,GAEH9B,EAAqB,MAAQ,EAC/B,CAEA,SAAS+B,GAAyB,CAE5B7B,EAAY,QAEdA,EAAY,MAAM,QAElBA,EAAY,MAAM,YAAc,EAEpC,CAEA,SAAS8B,EAAeF,EAAK,CAC3B,GAAIA,GAAOA,EAAI,SAAU,CAEvB,MAAMG,EAAW,GAAGH,EAAI,UAAY,IAAI,OAGlCI,EAAM,IAAI,eAChBA,EAAI,KAAK,MAAO,GAAGtC,CAAY,GAAGkC,EAAI,QAAQ,GAAI,EAAI,EACtDI,EAAI,aAAe,OAEnBA,EAAI,OAAS,UAAW,CACtB,GAAI,KAAK,SAAW,IAAK,CAEvB,MAAMC,EAAO,IAAI,KAAK,CAAC,KAAK,QAAQ,EAAG,CAAC,KAAM,WAAW,CAAC,EACpDC,EAAM,OAAO,IAAI,gBAAgBD,CAAI,EAGrCE,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAWJ,EAChBI,EAAK,MAAK,EAGV,WAAW,IAAM,CACf,OAAO,IAAI,gBAAgBD,CAAG,CAC/B,EAAE,GAAG,CACP,CACP,EAEIF,EAAI,KAAI,CACZ,MACIV,EAAU,MAAM,QAAQ,CAE5B,CAEA,eAAec,EAAaR,EAAK,CAC/B,GAAI,CACF,MAAMS,GAAa,QACjB,8BACA,OACA,CACE,KAAM,UACN,kBAAmB,OACnB,iBAAkB,IACnB,CACF,EAED,MAAMZ,EAAW,MAAMV,EAAM,OAAO,GAAGrB,CAAY,cAAckC,EAAI,EAAE,EAAE,EAEzE,GAAIH,EAAS,MAAQA,EAAS,KAAK,SAAW,UAC5CH,EAAU,CACR,KAAM,UACN,QAASG,EAAS,KAAK,SAAW,SAC1C,CAAO,EAGD5B,EAAU,MAAQA,EAAU,MAAM,OAAOyC,GAAQA,EAAK,KAAOV,EAAI,EAAE,MAEnE,OAAM,IAAI,MAAMH,EAAS,MAAM,SAAW,MAAM,CAEnD,OAAQF,EAAO,CACd,GAAIA,IAAU,SAAU,OAExB,QAAQ,MAAM,UAAWA,CAAK,EAC9BD,EAAU,MAAMC,EAAM,SAAW,MAAM,CACxC,CACH,CAGA,SAASgB,EAAWX,EAAK,CACvBpC,EAAO,KAAK,4BAA4BoC,EAAI,EAAE,EAAE,CAClD,CAEA,SAASY,EAAWC,EAAM,CACxB,OAAKA,EACE,IAAI,KAAKA,CAAI,EAAE,eAAgB,EADpB,GAEpB,CAEA,SAASC,EAAeC,EAAU,CAChC,GAAI,CAACA,EAAU,MAAO,QAGtB,IAAIC,EACJ,GAAI,OAAOD,GAAa,SAAU,CAEhC,GAAI,yBAAyB,KAAKA,CAAQ,EACxC,OAAOA,EAGTC,EAAU,WAAWD,CAAQ,CACjC,MACIC,EAAUD,EAIZ,GAAI,MAAMC,CAAO,EAAG,MAAO,QAG3B,MAAMC,EAAU,KAAK,MAAMD,EAAU,EAAE,EACjCE,EAAmB,KAAK,MAAMF,EAAU,EAAE,EAChD,MAAO,GAAGC,EAAQ,SAAU,EAAC,SAAS,EAAG,GAAG,CAAC,IAAIC,EAAiB,SAAQ,EAAG,SAAS,EAAG,GAAG,CAAC,EAC/F,CAEA,SAASC,EAAcC,EAAQ,CAO7B,MANc,CACZ,UAAW,UACX,QAAS,UACT,WAAY,OACZ,OAAQ,QACT,EACYA,CAAM,GAAK,MAC1B,CAEA,SAASC,EAAcD,EAAQ,CAO7B,MANc,CACZ,UAAW,MACX,QAAS,MACT,WAAY,MACZ,OAAQ,IACT,EACYA,CAAM,GAAKA,CAC1B,CAGA,SAASE,EAAiBC,EAAY,CACpC,OAAOA,EAAa,GAAGA,EAAW,QAAQ,CAAC,CAAC,IAAM,IACpD,CAGA,SAASC,EAAcC,EAAS1C,EAAO,CACrC,OAAQ0C,EAAO,CACb,IAAK,UACH1B,EAAchB,CAAK,EACnB,MACF,IAAK,SACHyB,EAAazB,CAAK,EAClB,KACH,CACH,2PAjeE,OAAA2C,EAAA,EAAAC,EA6IM,MA7INC,GA6IM,CA5IJC,EAMM,MANNC,GAMM,CALJC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAF,EAAa,UAAT,OAAI,EAAA,GACRG,EAGYC,EAAA,CAHD,KAAK,UAAW,QAAOnC,cAChC,IAA2B,CAA3BkC,EAA2BE,EAAA,KAAA,WAAlB,IAAQ,CAARF,EAAQG,EAAAC,EAAA,CAAA,wBAAU,SAE7B,EAAA,cAIUrE,EAAO,OAAIE,EAAS,MAAC,OAAM,GAAvCyD,IAAAC,EAoGM,MApGNU,GAoGM,CAnGJL,EAkGSM,EAAA,CAlGA,OAAQ,EAAE,EAAA,WAC4B,IAA0B,QAA7EX,EAgGeY,GAAA,KAAAC,GAhGoDvE,EAAS,MAAlBc,QAA1D0D,EAgGeC,EAAA,CAhGN,GAAI,GAAK,GAAI,GAAK,GAAI,GAAK,GAAI,EAAI,GAAI,EAA+B,IAAK3D,EAAM,GAAI,MAAM,6BAC5F,IA8FU,CA9FViD,EA8FUW,EAAA,CA9FD,MAAM,aAAa,OAAO,oBACjC,IA4FM,CA5FNd,EA4FM,MA5FNe,GA4FM,CA1FNf,EAyBM,MAAA,CAzBD,MAAM,kBAAmB,QAAKgB,GAAE9C,EAAchB,CAAK,IACtD8C,EAA8D,MAAA,CAAxD,IAAK9C,EAAM,cAAgBV,EAAkB,IAAI,mBACvDwD,EAAsE,MAAtEiB,GAAsEC,EAAvCjC,EAAe/B,EAAM,QAAQ,CAAA,EAAA,CAAA,EAGjDA,EAAM,SAAM,aAAvB2C,IAAAC,EAcM,MAdNqB,GAcM,CAbOjE,EAAM,SAAM,cAAvB2C,IAAAC,EASM,MATNsB,GASM,CARJjB,EAMEkB,EAAA,CALC,WAAYnE,EAAM,UAAQ,EAC1B,OAAQuC,EACT,OAAO,UACN,eAAc,EACd,YAAW,2BAEdS,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAF,EAAmB,YAAb,SAAM,EAAA,WAEdY,EAESU,EAAA,OAFO,KAAMhC,EAAcpC,EAAM,MAAM,cAC9C,IAAiC,KAA9BsC,EAActC,EAAM,MAAM,CAAA,EAAA,CAAA,qCAKtBA,EAAM,SAAM,aAAvB2C,IAAAC,EAEM,MAFNyB,GAEM,CADJpB,EAAgCE,EAAA,KAAA,WAAvB,IAAa,CAAbF,EAAaG,EAAAkB,EAAA,CAAA,6BAK1BxB,EAaM,MAbNyB,GAaM,CAZJzB,EAAyE,KAAA,CAArE,MAAM,cAAe,MAAO9C,EAAM,QAAa,EAAAgE,EAAAhE,EAAM,QAAQ,EAAA,EAAAwE,EAAA,EACjE1B,EAGM,MAHN2B,GAGM,CAFJ3B,EAAmE,OAAnE4B,GAAmEV,EAAtCnC,EAAW7B,EAAM,UAAU,CAAA,EAAA,CAAA,EACxD8C,EAA0D,OAA1D6B,GAA2BX,EAAAhE,EAAM,UAAQ,GAAA,EAAA,CAAA,IAGhCT,EAAO,OAAlBoD,IAAAC,EAKM,MALNgC,GAKM,CAJJ3B,EAGSmB,EAAA,CAHD,KAAK,QAAQ,KAAK,mBACxB,IAA2B,CAA3BnB,EAA2BE,EAAA,KAAA,WAAlB,IAAQ,CAARF,EAAQG,EAAAyB,EAAA,CAAA,YAAU,IAC3Bb,EAAGhE,EAAM,UAAQ,MAAA,EAAA,CAAA,6BAMvB8C,EA6CM,MA7CNgC,GA6CM,CA5CJhC,EAiBM,MAjBNiC,GAiBM,CAhBJ9B,EAOYC,EAAA,CANV,KAAK,QACL,KAAK,UACJ,QAAKY,GAAElC,EAAW5B,CAAK,EACvB,SAAUA,EAAM,SAA0B,aAAAA,EAAM,SAAM,sBACxD,IAED,CAAA,GAAAgD,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAFC,OAED,EAAA,qCACAC,EAOYC,EAAA,CANV,KAAK,QACL,KAAK,UACJ,QAAKY,GAAE3C,EAAenB,CAAK,EAC3B,SAAUA,EAAM,SAAM,wBACxB,IAED,CAAA,GAAAgD,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAFC,OAED,EAAA,uCAIFF,EAuBM,MAvBNkC,GAuBM,CAtBJ/B,EAqBcgC,EAAA,CArBD,QAAQ,QAAS,UAASnB,GAAArB,EAAcqB,EAAQ9D,CAAK,IAIrD,WACT,IAcmB,CAdnBiD,EAcmBiC,EAAA,KAAA,WAbjB,IAKmB,CALnBjC,EAKmBkC,EAAA,CAJjB,QAAQ,UACP,SAAUnF,EAAM,SAAM,wBACxB,IAED,CAAA,GAAAgD,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAFC,OAED,EAAA,2BACAC,EAMmBkC,EAAA,CALjB,QAAQ,SACR,QAAA,GACA,MAAM,0BACP,IAED,CAAA,GAAAnC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAFC,OAED,EAAA,qCAjBJ,IAEY,CAFZC,EAEYC,EAAA,CAFD,KAAK,QAAQ,KAAK,mBAC3B,IAAiC,CAAjCD,EAAiCE,EAAA,KAAA,WAAxB,IAAc,CAAdF,EAAcG,EAAAgC,EAAA,CAAA,yGA6BvCnC,EAgBYoC,GAAA,YAfDlG,EAAoB,2CAApBA,EAAoB,MAAA2E,GAC7B,MAAM,OACN,MAAM,MACN,mBAAA,GACC,SAAQ5C,cAET,IAQM,CAR6B9B,EAAY,OAA/CuD,IAAAC,EAQM,MARN0C,GAQM,CAPJxC,EAMS,QAAA,CALP,SAAA,GACC,IAAQ,GAAAM,EAAArE,CAAA,CAAY,GAAGK,EAAA,MAAa,QAAQ,GAC7C,MAAA,CAAmB,MAAA,MAAA,UACf,cAAJ,IAAIC,EACJ,IAAI,gEAMCL,EAAO,OAAlB2D,IAAAC,EAEM,MAFN2C,GAEM,CADJtC,EAAkCuC,GAAA,CAApB,KAAM,EAAG,SAAA,iBAKhB,CAAAxG,EAAA,QAAa,CAAAE,EAAA,OAAaA,EAAA,MAAU,SAAM,QADnDwE,EAGY+B,GAAA,OADV,YAAY"}